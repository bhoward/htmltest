<!DOCTYPE html>
<html>
  <head>
    <title>Putt Putnam County, Virtually!</title>
    <script src="golf.js"></script>
    <style>
    html, body {
      margin: 0 !important;
      padding: 0 !important;
    }
    </style>
  </head>
  <body>
    <canvas id="GolfCanvas"></canvas>
    <br />
    <input type="text" id="vx" value="10" />
    <input type="text" id="vy" value="10" />
    <button type="button" id="HitButton">Hit</button>
    <select id="holeSelect">
    </select>
    <input type="checkbox" id="firstPerson" />
    <label for="firstPerson">1st Person</label>

    <script>
      const holeSelect = document.getElementById("holeSelect");
      course.map((hole, i) => {
        const holeOpt = document.createElement("option");
        holeOpt.value = i;
        holeOpt.appendChild(document.createTextNode(hole.name));
        holeSelect.append(holeOpt);
      });

      const canvas = document.getElementById("GolfCanvas");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - 25; // TODO remove the -25

      window.onresize = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight - 25;
      };

      let state = new State(hole1);

      holeSelect.onchange = (event) => {
        const index = +event.target.value;
        if (index >= 0) {
          state = new State(course[index]);
        }
      };

      const hitButton = document.getElementById("HitButton");
      hitButton.onclick = (event) => {
        const vx = +document.getElementById("vx").value;
        const vy = +document.getElementById("vy").value;
        state.hit([vx, vy]);
      };

      const firstPerson = document.getElementById("firstPerson");

      state.render(canvas);

      const id = setInterval(() => {
        state.step();
        state.render(canvas);
        if (state.done) {
          state.done = false;
          setTimeout(nextHole, 5000);
        }
      }, 16);

      function nextHole() {
        const current = +holeSelect.value;
        const options = Array.from(holeSelect.options);
        if (current == 0) {
          holeSelect.value = Math.floor(1 + Math.random() * (options.length - 1));
        } else {
          holeSelect.value = 0;
        }
        holeSelect.dispatchEvent(new Event("change"));
      }
    </script>
  </body>
</html>