<!DOCTYPE html>
<html>
  <head>
    <title>Putt Putnam County, Virtually!</title>
    <script src="golf.js"></script>
    <style>
    html, body {
      margin: 0 !important;
      padding: 0 !important;
    }
    #background {
      width:300%; height:300%; 
      position:absolute; top:-100%; left:-100%;
      z-index: 1;
    }
    #GolfCanvas {
      width:100%; height:100%; 
      position:absolute; top:0px; left:0px;
      background-color: rgba(0,0,0,0);
      z-index: 2;
    }
    #debugControls {
      position:absolute; top:0px; left:0px;
      z-index: 3;
    }
    </style>
  </head>
  <body>
    <img src="hole1.png" id="background" />
    <canvas id="GolfCanvas"></canvas>
    <div id="debugControls">
      <input type="text" id="vx" value="10" />
      <input type="text" id="vy" value="10" />
      <button type="button" id="HitButton">Hit</button>
      <select id="holeSelect"></select>
      <input type="checkbox" id="firstPerson" />
      <label for="firstPerson">1st Person</label>
    </div>

    <script>
      const holeSelect = document.getElementById("holeSelect");
      course.map((hole, i) => {
        const holeOpt = document.createElement("option");
        holeOpt.value = i;
        holeOpt.appendChild(document.createTextNode(hole.name));
        holeSelect.append(holeOpt);
      });

      const canvas = document.getElementById("GolfCanvas");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      window.onresize = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      };

      let state = new State(hole1);

      holeSelect.onchange = (event) => {
        const index = +event.target.value;
        if (index >= 0) {
          state = new State(course[index]);
        }
      };

      const hitButton = document.getElementById("HitButton");
      hitButton.onclick = (event) => {
        const vx = +document.getElementById("vx").value;
        const vy = +document.getElementById("vy").value;
        state.hit([vx, vy]);
      };

      const firstPerson = document.getElementById("firstPerson");
      const background = document.getElementById("background");

      state.render(canvas);

      const id = setInterval(() => {
        state.step();
        state.render(canvas);
        if (state.done) {
          state.done = false;
          setTimeout(nextHole, 5000);
        }
      }, 16);

      function nextHole() {
        const current = +holeSelect.value;
        const options = Array.from(holeSelect.options);
        if (current == 0) {
          holeSelect.value = Math.floor(1 + Math.random() * (options.length - 1));
        } else {
          holeSelect.value = 0;
        }
        holeSelect.dispatchEvent(new Event("change"));
      }
    </script>
  </body>
</html>